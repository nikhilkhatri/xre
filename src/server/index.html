<!DOCTYPE html>
<html>
<head>
	<title>COMET - Streaming</title>
	<style type="text/css">
		#dagrediv {
			width: 100vw;
			height: 100vh;
			display: block;
		}
	</style>
	<script type="text/javascript">
		signal_array = [];
		cursor = 0;
	</script>

	<script type="text/javascript" src="scripts/cytoscape.js"></script>
	<script type="text/javascript" src="scripts/graph_handler.js"></script>
	<script type="text/javascript" src="scripts/sig_parser.js"></script>

	<script type="text/javascript">
		last_len = 0;
		obj = {
			xhr: new XMLHttpRequest(),
			getData: function(){
				this.xhr.onreadystatechange = this.showData;
				this.xhr.open("GET", "http://127.0.0.1:5000");
				this.xhr.send();
			},
			showData: function(){
				if(this.readyState == 3){
					var res = this.responseText;
					res = res.slice(last_len);
					var resArr = res.split("\n");

					for(var i=0; i < resArr.length; i+= 1){
						if(resArr[i].length > 1){
							signal_array.push(JSON.parse(resArr[i]));
							var slider = document.getElementById("slider");
							slider.max = parseInt(slider.max) + 1;
						}
					}

					// console.log(this.responseText)
				}
				if(this.readyState == 4){
					console.log("FINAL:" + this.responseText);
					// obj.getData();
				}
			}
		}
	</script>
	<style type="text/css">
		body{
			font-family: sans-serif;
		}
	</style>
</head>
<body onload="obj.getData()">
	<h2>XreÌ„</h2>
	<p>Example front end client for the Xre streaming server</p>
	<p>All logs are logged to console</p>

	<div id="dagrediv">
		<!-- treated as canvas -->
	</div>
	<input type="button" value="Prev" id="prev" onclick="rewind()"/>
	<input type="range" min=0 max=0 value=0 id="slider" step=1 width="100%">
	<input type="button" value="Next" id="next" onclick="forward()"/>
	<script type="text/javascript">
		// base_graph.container = document.getElementById('dagrediv');
		graph.container = document.getElementById('dagrediv');
		var slider = document.getElementById("slider");
		slider.oninput = function() {
			render(this.value);
		}

		var prev = document.getElementById("prev");
		function rewind() {
			//slider.value = Math.max(0, slider.value - 1);
			slider.stepDown()
			render(slider.value);
		}

		function forward() {
			//slider.value = Math.min(slider.max, slider.value + 1);
			slider.stepUp();
			render(slider.value);
		}

	</script>
</body>
</html>